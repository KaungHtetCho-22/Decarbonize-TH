name: Notify LINE Group on GitHub Push

on:
  push:
    branches:
      - data-eda 

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4  

      - name: Format Message and Send to LINE Notify
        run: |
          BRANCH_NAME=$(echo "${{ github.ref }}" | sed 's/refs\/heads\///')
          COMMIT_MESSAGE=$(git log -1 --pretty=format:"%s")  # Get only the commit title
          COMMIT_HASH=$(echo "${{ github.sha }}" | cut -c1-7)  # Shortened commit hash
          COMMIT_URL="https://github.com/${{ github.repository }}/commit/${{ github.sha }}"

          MESSAGE="ğŸ”” *GitHub Push Notification*
          ğŸ“Œ *Repository:* ${{ github.repository }}
          ğŸ“‚ *Branch:* $BRANCH_NAME
          ğŸ”— *Commit:* [$COMMIT_HASH]($COMMIT_URL)
          ğŸ“ *Message:* $COMMIT_MESSAGE"

          curl -X POST https://notify-api.line.me/api/notify \
            -H "Authorization: Bearer ${{ secrets.LINE_NOTIFY_TOKEN }}" \
            -F "message=$MESSAGE"
